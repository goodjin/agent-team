# Project Agent 需求文档

## 1. 项目概述

### 1.1 项目定位
Project Agent 是一个**私人智能体指挥中心**，专为个人开发者/技术专家设计。通过定义不同的专家角色来自动化完成软件开发的全流程，支持自然语言交互，提供类似 Claude Code 的智能 AI Agent 能力。

系统核心目标：
- **单人操控一切**：单用户模式，无需权限控制，所有功能直接可用
- **多项目隔离**：支持多个独立项目，各自配置、数据、任务完全隔离
- **多智能体协同**：多个专业智能体角色协同工作，高效完成任务
- **长期无人值守**：可长时间稳定运行，处理复杂庞大的任务

### 1.2 核心价值
- **多角色协作**：模拟真实开发团队，不同角色负责不同职责
- **自动化流程**：从需求分析到代码实现、测试、文档的完整自动化
- **智能理解**：支持自然语言输入，智能理解用户意图
- **灵活配置**：支持多种 LLM 服务商，灵活的配置系统
- **多种交互方式**：Web界面、API接口

### 1.3 目标用户
- **个人开发者**：独立工作的软件开发者
- **技术专家**：需要处理复杂技术任务的专业人士
- **独立创作者**：独自管理多个项目的创作者

## 2. 功能需求

### 2.1 多角色系统
**需求描述**：系统应支持多个专家角色，每个角色有独立的系统提示词定义。智能体由大模型根据任务需要创建，按角色身份执行任务。项目经理负责项目进度监控和智能体管理。

**角色定义**：
- **产品经理 (Product Manager)**
  - 职责：需求分析、用户故事编写
  - 输出：需求文档、用户故事

- **项目经理 (Project Manager)**
  - 职责：项目进度监控与汇报、智能体状态检查与重启、项目文档管理
  - 输出：项目进度报告、智能体状态报告
  - **核心职责说明**：
    - 监督项目整体进度，定期汇总各任务完成情况
    - 定时检查各智能体运行状态，发现停止的智能体进行重启
    - 负责项目文档的收集、整理和归档管理
    - 接收其他智能体完成任务后的汇报

- **架构师 (Architect)**
  - 职责：系统架构设计、技术选型、架构决策
  - 输出：架构设计文档、技术方案

- **开发者 (Developer)**
  - 职责：代码实现、功能开发、代码优化
  - 输出：源代码、代码注释

- **测试工程师 (Tester)**
  - 职责：测试用例编写、测试执行、质量保证
  - 输出：测试用例、测试报告

- **文档编写者 (Doc Writer)**
  - 职责：技术文档编写、API文档生成、用户手册
  - 输出：技术文档、API文档、使用指南

**角色创建**：
- **用户创建**：用户可手动创建新角色，定义角色名称、系统提示词等
- **大模型创建**：大模型根据项目信息和任务情况自主判断是否需要创建新角色
- 角色创建后持久化存储，可被编辑或禁用

**智能体管理**：
- 智能体统一由大模型根据任务需要创建
- 每个智能体绑定一个角色，使用该角色的系统提示词
- 智能体完成任务后向项目经理汇报
- 项目经理负责检查停止的智能体并进行重启

**技术要求**：
- 每个角色有独立的系统提示词文件
- 角色提示词支持变量替换
- 角色可配置专属的 LLM 模型参数

### 2.2 任务管理引擎
**需求描述**：任务采用编号管理，由大模型根据需求进行详细拆分，分配给智能体执行。

**任务编号**：
- 任务编号格式为 `T001`、`T002`、`T003`...
- 编号在项目内唯一，系统自动递增生成
- 编号用于任务定位和排序

**任务分类**：
- 大模型根据任务性质自动进行分类
- 不同分类的任务存放在不同子目录中
- 分类示例：需求分析(REQ)、架构设计(ARCH)、开发(DEV)、测试(TEST)、文档(DOC)等

**任务拆分**：
- 大模型根据用户需求进行详细任务拆分
- 拆分后的每个任务有独立编号
- 拆分结果作为新任务加入任务列表

**任务数据结构**：
- 任务ID：格式 T001，项目内唯一
- 任务分类：任务所属分类
- 任务标题：任务简要描述
- 任务描述：任务详细说明
- 进度标记：大模型可更新的进度状态
- 执行状态：pending（待处理）、running（执行中）、done（已完成）
- 执行记录：执行过程中的信息

**任务状态**：
- **待处理 (pending)**：任务已创建，等待执行
- **执行中 (running)**：任务正在执行
- **已完成 (done)**：任务已完成

**任务执行**：
- 智能体接收任务，以角色身份与大模型会话执行任务
- 大模型更新任务进度标记
- 任务完成向项目经理汇报

### 2.3 工具链系统
**需求描述**：系统提供丰富的工具集，支持开发操作和 AI 创作。工具由大模型根据需要发现和使用，用户只需管理工具配置。

**工具分类**：
- **开发工具**：文件操作、Git 操作、代码分析
- **浏览器工具**：网页浏览、搜索、页面交互、截图、执行 JS
- **AI 生成工具**：文生图、文生视频、图生图、视频编辑

**AI 生成工具管理**：
- AI 生成工具内置支持，也可由用户添加
- 工具管理机制与 LLM 类似：用户只需提供 API Key 等必要配置
- 工具配置独立存储，格式由具体工具决定

**工具发现与使用**：
- 大模型根据任务需要自动发现和使用工具
- 工具执行结果标准化，方便大模型提取结果
- 用户对工具进行启用/禁用管理

### 2.4 LLM 多服务商支持
**需求描述**：系统支持多种 LLM 服务商，用户只需提供 API Key 等基本配置，系统自动处理其他配置细节。

**支持的服务商**：
- 国际：Anthropic Claude、OpenAI GPT、Azure OpenAI、Ollama
- 国内：通义千问、智谱 GLM、MiniMax、Kimi、DeepSeek、英码

**配置方式**：
- 用户仅需提供 API Key（通过环境变量或配置文件）
- 其他配置项（模型列表、参数限制等）由系统预设
- 角色可配置专属的服务商和模型

**故障转移机制**：
- 当首选服务商不可用时，自动切换到其他可用服务商
- 切换过程对用户透明
- 记录故障转移日志

### 2.5 提示词配置系统
**需求描述**：系统使用 Markdown 文件配置角色提示词，存储在角色目录下。

**配置方式**：
- 角色提示词存储为 Markdown 文件
- 文件路径：roles/{角色ID}/system_prompt.md
- 支持变量替换，如 {{project_name}}

**提示词模板**：
- 角色系统提示词定义
- 任务执行流程规范

### 2.6 角色工作流
**需求描述**：工作流是角色系统提示词中定义的执行流程规范，属于角色管理的一部分。

**工作流定义**：
- 工作流是角色提示词中关于大模型应遵守流程的描述
- 定义角色执行任务的典型步骤和质量检查点
- 用户可与大模型协作调整工作流内容

**调试模式**：
- 任务执行第一步后交由用户确认
- 用户可选择：重新执行当前步骤，或继续后续流程
- 适用于需要用户干预的关键任务

**工作流存储**：
- 工作流配置存储在角色提示词中
- 格式为 Markdown，包含流程步骤说明

### 2.7 规则系统
**需求描述**：规则是对大模型的要求，存储为 Markdown 文件，按优先级注入到角色提示词中。

**规则分类**：
- **全局规则**：适用于所有项目和角色
- **项目规则**：适用于特定项目，优先级最高
- **角色规则**：适用于特定角色，优先级次之

**规则存储**：
- 规则存储为 Markdown 文件，位于 rules/ 目录
- 文件命名规则：{类型}_{名称}.md
- 通过命名规则关联到角色或项目

**规则优先级**：
- 项目规则 > 角色规则 > 全局规则
- 规则冲突时，由大模型自行判断如何处理
- 规则违反由大模型自行判断处理

### 2.8 执行模式
**需求描述**：系统支持两种执行模式。

**自动模式**：
- 大模型自主执行任务，无需用户确认
- 适用于常规任务

**交互模式**：
- 任务执行过程中需要用户输入或确认
- 适用于需要用户决策的任务

### 2.9 自由输入
**需求描述**：用户可通过自然语言描述需求，系统理解后执行相应操作。

**功能说明**：
- 支持中英文混合输入
- 大模型自动识别任务类型并进行分类
- 支持任务上下文理解

### 2.10 智能 AI Agent
**需求描述**：系统提供与大模型交互的 Agent 能力，支持自然语言对话和任务执行。

**功能说明**：
- 理解用户自然语言请求
- 分析代码和项目结构
- 自主使用工具完成操作
- 多轮对话和上下文记忆

### 2.11 项目管理
**需求描述**：系统支持多个独立项目，项目间数据完全隔离。

**项目状态**：
- **活动**：项目正在运行
- **归档**：项目已完成，保留历史数据

**项目数据**：
- 每个项目独立存储数据
- 包含任务、角色、配置、日志等
- 项目切换不影响其他项目

### 2.12 配置系统
**需求描述**：系统使用默认配置文件，启动时检查配置有效性。

**配置文件**：
- 默认位置：~/.agent-team/config.yaml
- 格式：YAML
- 用户只需配置 API Key 等必要信息

**配置检查**：
- 启动时检查配置文件是否存在
- 检查配置文件格式是否正确
- 配置错误时停止启动并提示用户

### 2.13 日志系统
**需求描述**：系统记录运行日志，支持分级输出。

**日志级别**：
- info：普通信息
- error：错误信息

**日志内容**：
- 记录启动、任务、错误等信息
- API Key 等敏感信息不记录到日志

### 2.14 错误处理
**需求描述**：系统提供基本的错误处理机制。

**错误处理**：
- 显示错误提示信息
- 记录错误日志
- 任务错误时记录错误信息并继续其他任务

## 3. 非功能需求

### 3.1 性能要求
- 任务创建响应时间 < 100ms
- LLM 调用支持超时设置
- 支持大文件流式处理

### 3.2 可靠性要求
- 单个任务失败不影响其他任务
- 支持数据持久化
- 项目数据自动保存，防止丢失
- 支持异常退出后恢复

### 3.3 长期运行支持
**守护机制**：
- 系统运行异常退出后自动重启
- 重启后自动恢复未完成的任务

**任务自动恢复**：
- 任务进度标记持久化存储
- 系统重启后从进度标记恢复执行

### 3.4 安全性
**日志记录**：
- 记录系统运行日志
- 敏感信息（API Key）不记录到日志

**数据保护**：
- 敏感配置信息加密存储
- 用户数据本地保存，不上传到云端

### 3.5 兼容性
- 支持 Node.js 18+
- 支持 TypeScript 5+
- 支持 Windows、macOS、Linux

## 4. 术语表

| 术语 | 说明 |
|------|------|
| **角色 (Role)** | 定义智能体身份和行为的系统提示词模板，包含角色描述、职责、流程规范等 |
| **智能体 (Agent)** | 根据角色模板创建的具体执行实例，以角色身份与大模型交互完成任务 |
| **项目经理 (Project Manager)** | 负责项目进度监控、智能体状态检查、项目文档管理的特殊角色 |
| **任务 (Task)** | 项目中的具体工作单元，有唯一编号(T001)，分配给智能体执行 |
| **任务分类** | 按任务性质划分的类别，如需求分析(REQ)、架构设计(ARCH)、开发(DEV)等 |
| **进度标记** | 记录任务执行进度的字段，由大模型更新，用于追踪任务状态 |
| **工作流** | 角色提示词中定义的执行流程规范，指导大模型如何完成角色 |
| **规则职责** | 对大模型的要求，以 Markdown 文件存储，按优先级注入到角色提示词 |
| **项目 (Project)** | 独立的数据空间，包含任务、角色、配置等，相互隔离 |
| **故障转移** | 当首选 LLM 服务商不可用时，自动切换到其他可用服务商 |
| **调试模式** | 任务执行过程中每步都需用户确认的执行模式 |
| **系统提示词** | 与大模型会话时提供的初始提示，定义角色身份和行为规范 |

---

**文档版本**：2.5.0
**最后更新**：2026-01-31
**维护者**：Project Agent Team

## 附录：产品定位变更记录

### v2.0.0 (2025-01-31)
- **目标用户调整**：从"团队/组织"改为"个人开发者/技术专家"
- **权限简化**：移除权限控制系统，单用户直接操作一切
- **UI/UX 强化**：Web 管理界面升级为"私人智能体指挥中心"
- **长期运行**：新增长期无人值守运行支持
- **新手引导**：简化为快速配置检查
- **项目隔离**：强调多项目独立运行能力

### v2.1.0 (2025-01-31)
- **上下文管理优化**：从"自动压缩"升级为"智能拆分"，支持按语义边界拆分上下文片段，按需加载
- **自动任务拆分与规划**：新增任务分解引擎、动态规划、分支处理、回溯机制
- **工具管理与自动化发现**：新增工具注册管理、自动化发现（目录扫描/注解发现/插件加载）、工具使用优化
- **系统提示词模板管理**：明确7个关键环节需要提示词模板

### v2.2.0 (2025-01-31)
- **新增项目经理角色**：负责项目承接、定时检查、进度汇报、问题发现、智能协调解决
- **动态角色创建**：系统可根据任务类型自动创建新角色
- **新增浏览器工具**：网页浏览、网页搜索、页面交互、页面截图、JavaScript 执行、多标签页管理
- **新增AI生成工具**：文生图、文生视频、图生图、视频编辑

### v2.3.0 (2025-01-31)
- **角色与智能体关系明确**：角色模板与智能体实例分离，智能体按角色创建
- **任务编号管理**：任务采用 T001 格式编号管理
- **任务分类存储**：不同分类任务存放在不同子目录
- **任务进度标记**：预留进度字段方便大模型更新
- **角色工作流整合**：工作流定义为角色执行规范

### v2.4.0 (2025-01-31)
- **项目经理职责明确**：监督进度、智能体重启、文档管理
- **任务状态简化**：待处理、执行中、已完成
- **移除任务依赖**：按编号排序，无需显式依赖
- **工作流作为角色一部分**：调试模式支持用户确认

### v2.5.0 (2026-01-31)
- **配置简化**：仅使用默认配置文件，启动时检查存在性和格式
- **角色创建方式**：支持用户创建和大模型根据项目任务自主创建
- **移除角色继承**：角色创建更简单
- **AI工具管理简化**：用户仅需提供 API Key，工具发现由大模型完成
- **规则系统简化**：规则为 Markdown 文件，按项目>角色>全局优先级
- **移除 CLI**：暂不实现命令行工具
- **长期运行简化**：仅保留守护机制和任务自动恢复
- **安全性简化**：仅日志记录和加密存储敏感信息
- **新增术语表**：解释核心概念
